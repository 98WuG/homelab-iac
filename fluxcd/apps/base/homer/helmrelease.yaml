---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
  namespace: homer
spec:
  chart:
    spec:
      chart: homer
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home
        namespace: flux-system
  interval: 10m0s
  timeout: 10m0s
  values:
    controller:
      replicas: 3
      strategy: RollingUpdate
    image:
      repository: docker.io/b4bz/homer
      tag: v22.10.1
    ingress:
      main:
        enabled: true
        ingressClassName: nginx-public
        annotations:
          homelab/public: "true"
          external-dns.alpha.kubernetes.io/hostname: homer.${DOMAIN}
          external-dns.alpha.kubernetes.io/target: ${DOMAIN}
        hosts:
        - host: homer.${DOMAIN}
          paths:
          - path: /
            pathType: Prefix
    initContainers:
      dashboard-icons:
        name: dashboard-icons
        image: docker.io/bitnami/git:2.37.3-debian-11-r2
        command:
        - "/bin/sh"
        - "-c"
        - "cp /config/* /www/assets/* && git clone https://github.com/walkxcode/Dashboard-Icons /www/assets/icons"
        volumeMounts:
        - name: config
          mountPath: /config
        - name: assets
          mountPath: /www/assets
    persistence:
      config:
        enabled: false
        mountPath: /config
      assets:
        enabled: true
        type: emptyDir
        medium: Memory
        sizeLimit: 1Gi
        mountPath: /www/assets
    configmap:
      config:
        enabled: true
        data:
          config.yml: |
            title: "${DOMAIN} dashboard"
            subtitle: "A full list of ${DOMAIN} services. Some services may be internal-only."

            header: true
            footer: false
            defaults:
              layout: list

            theme: default
            colors:
              light:
                highlight-primary: "#3367d6"
                highlight-secondary: "#4285f4"
                highlight-hover: "#5a95f5"
                background: "#f5f5f5"
                card-background: "#ffffff"
                text: "#363636"
                text-header: "#ffffff"
                text-title: "#303030"
                text-subtitle: "#424242"
                card-shadow: rgba(0, 0, 0, 0.1)
                link-hover: "#363636"
              dark:
                highlight-primary: "#3367d6"
                highlight-secondary: "#4285f4"
                highlight-hover: "#5a95f5"
                background: "#131313"
                card-background: "#2b2b2b"
                text: "#eaeaea"
                text-header: "#ffffff"
                text-title: "#fafafa"
                text-subtitle: "#f5f5f5"
                card-shadow: rgba(0, 0, 0, 0.4)
                link-hover: "#ffdd57"
            services:
              - name: "Federated"
                icon: "fas fa-project-diagram"
                items:
                  - name: "Element"
                    logo: "/assets/icons/png/element.png"
                    subtitle: "Federated, E2EE messaging"
                    url: "https://element.${DOMAIN}"
                  - name: "Cinny"
                    logo: "/assets/icons/png/cinny.png"
                    subtitle: "Yet another Matrix client"
                    url: "https://cinny.${DOMAIN}"
                  - name: "Hydrogen"
                    logo: "/assets/icons/png/element.png"
                    subtitle: "Lightweight Matrix client"
                    url: "https://hydrogen.${DOMAIN}"
                  - name: "Matrix Synapse"
                    logo: "/assets/icons/png/matrix-synapse.png"
                    subtitle: "Federated protocol"
                    url: "https://matrix.${DOMAIN}/_matrix/static/"
                  - name: "Matrix Federation Tester"
                    logo: "/assets/icons/png/matrix.png"
                    subtitle: "Tool to test Matrix federation"
                    url: "https://federationtester.${DOMAIN}"
              - name: "Media"
                icon: "fas fa-film"
                items:
                  - name: "Jellyfin"
                    logo: "/assets/icons/svg/jellyfin.svg"
                    subtitle: "Media streaming server"
                    url: "https://jellyfin.${DOMAIN}"
                  - name: "Jellyfin Vue"
                    logo: "/assets/icons/png/jellyfin-vue.png"
                    subtitle: "Alternative Jellyfin frontend"
                    url: "https://jf-vue.${DOMAIN}"
                  - name: "Jellyseerr"
                    logo: "/assets/icons/svg/jellyseerr.svg"
                    subtitle: "Media request service"
                    url: "https://jellyseerr.${DOMAIN}"
                  - name: "Komga"
                    logo: "/assets/icons/png/komga.png"
                    subtitle: "Comic book library"
                    url: "https://komga.${DOMAIN}"
              - name: "Cloud services"
                icon: "fas fa-cloud"
                items:
                  - name: "GitLab"
                    logo: "/assets/icons/png/gitlab.png"
                    subtitle: "GitLab instance"
                    url: "https://gitlab.${DOMAIN}/explore/"
                  - name: "Nextcloud"
                    logo: "/assets/icons/png/nextcloud.png"
                    subtitle: "File share and collaboration platform"
                    url: "https://cloud.${DOMAIN}"
                  - name: "Vaultwarden"
                    logo: "/assets/icons/png/bitwarden.png"
                    subtitle: "Password manager"
                    url: "https://vaultwarden.${DOMAIN}"
                  - name: "Send"
                    logo: "/assets/icons/png/firefoxsend.png"
                    subtitle: "Client-side encrypted file sharing"
                    url: "https://send.${DOMAIN}"
                  - name: "Privatebin"
                    logo: "/assets/icons/png/privatebin.png"
                    subtitle: "Zero-knowledge encrypted pastebin"
                    url: "https://paste.${DOMAIN}"
                  - name: "Wallabag"
                    logo: "/assets/icons/png/wallabag.png"
                    subtitle: "Pocket alternative"
                    url: "https://wallabag.${DOMAIN}"
              - name: "Misc"
                icon: "fas fa-align-center"
                items:
                  - name: "Authentik"
                    logo: "/assets/icons/svg/authentik-orange.svg"
                    subtitle: "Identity Provider and Single Sign-On"
                    url: "https://auth.${DOMAIN}"
                  - name: "Ntfy"
                    logo: "/assets/icons/png/ntfy.png"
                    subtitle: "Push notifications"
                    url: "https://ntfy.${DOMAIN}"
                  - name: "Gotify"
                    logo: "/assets/icons/svg/gotify.svg"
                    subtitle: "Push notifications"
                    url: "https://gotify.${DOMAIN}"
                  - name: "Librespeed"
                    logo: "/assets/icons/png/librespeed.png"
                    subtitle: "Internet speedtest"
                    url: "https://speedtest.${DOMAIN}"
                  - name: "Wiki"
                    logo: "/assets/icons/png/wikijs.png"
                    subtitle: "wiki.js instance"
                    url: "https://wiki.${DOMAIN}"
                  - name: "Arch Linux mirror"
                    logo: "/assets/icons/png/files.png"
                    subtitle: "Arch Linux repositories mirror"
                    url: "https://mirror.${DOMAIN}"
                  - name: "AUR packages"
                    logo: "/assets/icons/png/files.png"
                    subtitle: "Repository for packages built from AUR"
                    url: "https://aur.${DOMAIN}"
              - name: "Downloads"
                icon: "fas fa-download"
                items:
                  - name: "Sonarr (Internal)"
                    logo: "/assets/icons/svg/sonarr.svg"
                    subtitle: "TV series PVR system"
                    url: "https://sonarr.${DOMAIN}"
                  - name: "Radarr (Internal)"
                    logo: "/assets/icons/svg/radarr.svg"
                    subtitle: "Movies PVR system"
                    url: "https://radarr.${DOMAIN}"
                  - name: "Prowlarr (Internal)"
                    logo: "/assets/icons/svg/prowlarr.svg"
                    subtitle: "Indexers"
                    url: "https://prowlarr.${DOMAIN}"
                  - name: "Transmission (Internal)"
                    logo: "/assets/icons/png/transmission.png"
                    subtitle: "P2P torrent client"
                    url: "https://transmission.${DOMAIN}"
              - name: "Management"
                icon: "fas fa-home"
                items:
                  - name: "Proxmox VE (Internal)"
                    logo: "/assets/icons/png/proxmox.png"
                    subtitle: "Proxmox Virtual Environment web management"
                    url: "https://pve.${DOMAIN}"
                  - name: "OPNsense (Internal)"
                    logo: "/assets/icons/png/opnsense.png"
                    subtitle: "Open-source firewall"
                    url: "https://kizu.${DOMAIN}:8443"
                  - name: "Portainer (Internal)"
                    logo: "/assets/icons/svg/portainer.svg"
                    subtitle: "Docker and Kubernetes management dashboard"
                    url: "https://portainer.${DOMAIN}"
                  - name: "Ceph Dashboard (Internal)"
                    logo: "/assets/icons/svg/ceph.svg"
                    subtitle: "Distributed object, block, and file storage platform"
                    url: "https://10.40.0.30:8443/"
                  - name: "Grafana (Internal)"
                    logo: "/assets/icons/svg/grafana.svg"
                    subtitle: "Data visualization platform"
                    url: "https://grafana.${DOMAIN}"
                  - name: "Uptime Kuma"
                    logo: "/assets/icons/svg/uptime-kuma.svg"
                    subtitle: "Uptime monitoring"
                    url: "https://uptime.${DOMAIN}"
                    slug: "services"
                    type: "UptimeKuma"
