---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: synapse
resources:
- ../../base/synapse
- discord
patches:
- target:
    kind: HelmRelease
    name: synapse
  patch: |-
    apiVersion: apps/v1
    kind: HelmRelease
    metadata:
      name: synapse
    spec:
      values:
        serverName: ${DOMAIN}
        publicServerName: matrix.${DOMAIN}
        synapse:
          strategy:
            type: RollingUpdate
        persistence:
          enabled: true
          storageClass: ceph-cephfs-ssd-sc
          size: 60Gi
          accessMode: ReadWriteMany
        ingress:
          annotations:
            external-dns.alpha.kubernetes.io/hostname: matrix.${DOMAIN}
            external-dns.alpha.kubernetes.io/target: ${DOMAIN}
            homelab/public: "true"
