---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- keydb
- ../../base/gitlab
patches:
- target:
    kind: HelmRelease
    name: gitlab
  patch: |-
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: gitlab
    spec:
      values:
        global:
          redis:
            password:
              enabled: true
              secret: gitlab-keydb-secret
              key: password
            host: gitlab-keydb-headless
            port: "6379"
        redis:
          install: false
