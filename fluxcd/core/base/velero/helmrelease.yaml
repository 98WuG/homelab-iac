---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: velero
  namespace: velero
spec:
  chart:
    spec:
      chart: velero
      sourceRef:
        kind: HelmRepository
        name: vmware-tanzu
        namespace: flux-system
  interval: 10m0s
  values:
    image:
      repository: velero/velero
      tag: v1.8.1
      pullPolicy: IfNotPresent
    initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.4.1
      imagePullPolicy: IfNotPresent
      volumeMounts:
      - mountPath: /target
        name: plugins
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    upgradeCRDs: true
    cleanUpCRDs: false
    configuration:
      provider: aws
      backupStorageLocation:
        name: velero-onprem
        bucket: velero
        provider: aws
        default:
        config:
          region: default
          s3ForcePathStyle: "true"
          s3Url: "${S3_URL}"
      defaultVolumesToRestic: true
    rbac:
      create: true
      clusterAdministrator: true
    credentials:
      useSecret: true
      name: velero-onprem
      existingSecret: velero-onprem
      secretContents: {}
    backupsEnabled: true
    snapshotsEnabled: false
    deployRestic: true
