---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: velero
  namespace: velero
spec:
  chart:
    spec:
      chart: velero
      version: "2.32.6"
      sourceRef:
        kind: HelmRepository
        name: vmware-tanzu
        namespace: flux-system
  interval: 10m0s
  values:
    image:
      repository: velero/velero
      tag: v1.9.3
      pullPolicy: IfNotPresent
    initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.5.2
      imagePullPolicy: IfNotPresent
      volumeMounts:
      - mountPath: /target
        name: plugins
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false
        additionalLabels:
          release: prometheus
        namespace: prometheus
    upgradeCRDs: true
    cleanUpCRDs: false
    resources:
      requests:
        cpu: 125m
        memory: 128Mi
      limits:
        cpu: null
        memory: 512Mi
    configuration:
      provider: aws
      backupStorageLocation:
        name: velero-onprem
        bucket: velero
        provider: aws
        default: true
        config:
          region: default
          s3ForcePathStyle: "true"
          s3Url: "${S3_URL}"
      defaultVolumesToRestic: true
    rbac:
      create: true
      clusterAdministrator: true
    credentials:
      useSecret: true
      name: velero-onprem
      existingSecret: velero-onprem
      secretContents: {}
    backupsEnabled: true
    snapshotsEnabled: false
    deployRestic: true
    restic:
      resources:
        requests:
          cpu: 125m
        limits:
          cpu: null
