#!/bin/sh

curl -sfL https://get.k3s.io | K3S_TOKEN=${secret} sh -s - ${mode} \
${init} \
%{ if server ~}
--tls-san ${vip} \
--disable traefik \
--disable servicelb \
--disable local-storage \
--disable-cloud-controller \
--kube-controller-manager-arg bind-address=0.0.0.0 \
--kube-proxy-arg metrics-bind-address=0.0.0.0 \
--kube-scheduler-arg bind-address=0.0.0.0 \
--etcd-expose-metrics true \
--kubelet-arg containerd=/run/k3s/containerd/containerd.sock \
%{ endif ~}
